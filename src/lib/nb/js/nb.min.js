!function(){var t={disabled:!0,checked:!0},e=[];Object.create||(Object.create=function(t,e){function n(){}if("undefined"!=typeof e)throw"The multiple-argument version of Object.create is not provided by this browser and cannot be shimmed.";return n.prototype=t,new n});var n,i=function(){return{}},o=function(t,e){var n,o=window;if(t){var a=t.split(".");n=a.pop(),$.each(a,function(t,e){var n=o[e];return n?void(o=n):void(o=o[e]=new i)})}return n&&(o[n]=e),e},a=function(t,e){var n,i=e||window,o=i;return void 0===t?o:(""===t?o=o[t]:(n=t.split("."),$.each(n,function(t,e){return o=i=i[e],o?void 0:!1})),o)},r=function(t,e){var n,i,o,a=t.lastIndexOf("."),r=this.__model;l.get(t,r);a>0?(n=t.substring(0,a),o=t.substring(1),i=l.get(n,this.__model),i[o]=e):this.__model[t]=e},s=function(t,i){var r=t.name,s=(t.view,t.parent);if(s&&"string"==typeof s){var f=s;if(s=a(s),!s)throw"Parent not found!["+f+"]"}i||$.each(e,function(e,n){s=n.fn.call(n.scope,t,s)});var d=c(s||n,t);return r?o(r,d):d},c=function(t,e){var n=t.prototype,i=Object.create(n),o=function(){var t=this.init;t&&t.apply(this,arguments)};return $.each(e,function(t,e){"method"==t?f(i,e):i[t]=e}),o.prototype=i,o},f=function(t,e){var n=e||{};$.each(n,function(e,n){var i=t[e];void 0!=i&&"function"==typeof i?"init"===e?t[e]=function(t,e){return function(){return t.apply(this,arguments),e.apply(this,arguments)}}(i,n):t[e]=function(t,e){return function(){var n,i;return n=this.parent,this.parent=t,i=e.apply(this,arguments),this.parent=n,i}}(i,n):t[e]=n})},d=function(){};n=c(d,{init:function(){},on:function(t){var e,n=this.__eventMap,i=t.name,o=t.scope,a=t.fn;n||(n=this.__eventMap={}),e=n[i],e||(e=n[i]=[]),e.push({scope:o,fn:a})},fire:function(t,e){var n=this.__eventMap,i=(n?n[t]:[])||[];$.each(i,function(t,n){var i=n.scope,o=n.fn;o.call(i,e)})},callHandler:function(t,e){var n=this.getHandler(t);if(!n)throw new Error("Handler nout found.["+t+"]");n.call(this,e)},getHandler:function(t){return this[t+"Handler"]},setOpts:function(t){return t instanceof l.Model?this.setModel(t):this.setJSONData(t)},setJSONData:function(t){var e=this._model;return e||(e=this.initDefaultModel()),e.setOpts(t),e},initDefaultModel:function(){var t=l.getType(this.model||"nb.Model"),e=this.getModel();if(!t)throw new Error("Can not get model type for ["+this.model+"]."+(this.name?"view name is ["+this.name+"]":""));return e||(e=this.setModel(new t)),e},resetModel:function(t){t.reset()},setModel:function(t){var e=this,n=this.__viewInstance,i=n.$modelMappingList,o=n.$bindMappingList,a=this._modelEvents=this._modelEvents||[];return this._model&&this.resetModel(this._model),this._model=t,i&&$.each(i,function(n,i){var o,a,r,s=i.target,c=i.model,f=t,d=c;if("string"==typeof c){if(c.indexOf(".")>0&&(r=c.split("."),d=r.pop(),$.each(r,function(t,e){f=f.get(e)}),!f))throw new Error("target model not found.["+r+"]");""===d?s.setModel(f):f.onChange({name:d,scope:s,fn:function(t){s.setOpts(t.data)}})}else o=l.getType(s.model||"nb.Model"),a=s.getModel()||new o,$.each(c,function(n,i){n?t.onChange({name:n,scope:a,fn:function(t){a.set(i,t.data)}}):(e._addRootModelWatcher(i,s),a.set(i,t))}),s.getModel()||s.setModel(a)}),a&&$.each(a,function(e,n){var i=n.target,o=i.getModel();o.set(n.key,t)}),o&&$.each(o,function(n,i){e._addBind(i,t)}),this.onModelReady(t),t},_addRootModelWatcher:function(t,e){var n=this._modelEvents=this._modelEvents||[];n.push({target:e,key:t})},_addBind:function(e,n){var i=e.target,o=n,a=e.model,r=e.name,s=e.attrName,c=e.opts,f="change keyup",d=c?c.event||f:f;if(void 0!==a&&(o=n.get(a),!o))throw Error("Can not found model for ["+a+"]");t[s]?(i.attr("data-nb-bind",r),i.on(d,function(t){var e=i.prop(s);o.set(r,e)})):"value"===s&&"INPUT"===i.prop("tagName")&&i.on(d,function(t){var e=i.val();o.set(r,e)}),o.onChange({name:r,scope:i,fn:function(n){var o=n.data,a=""+o,r=n.origin;switch(e.attrType){case"text":i.text(a);break;case"html":i.html(a);break;case"attr":t[s]?i.prop(s,o):i.attr(e.attrName,a);break;case"class":i.removeClass(r||""),i.addClass(a);break;case"style":i.css(e.attrName,a)}}})},onModelReady:function(t){},getModel:function(){return this._model}});var u=function(t){e.push(t)},l=window.nb={};l.name=o,l.define=s,l.extend=c,l.addDefineInterceptor=u,l.get=a,l.set=r,l.getType=function(t){var e=t;if("string"==typeof t){var n=t;if(e=l.get(n),null==e)throw"Type not found["+n+"]"}return e}}(),function(){var t=1;nb.define({name:"nb.Model",method:{init:function(){this.__instanceId=t++,this.__model={},this.__eventMap={}},setOpts:function(t){var e=t||{},n=this;$.each(e,function(t,e){void 0!=e&&n.set(t,e,{skipSameValue:!1})})},get:function(t){var e=nb.get(t,this.__model);return e},set:function(t,e,n){var i,o,a,r=t.lastIndexOf("."),s=this.__model,c=nb.get(t,s);r>0?(i=t.substring(0,r),a=t.substring(1),o=nb.get(i,this.__model),o[a]=e):this.__model[t]=e,this._fireChangeEvent(t,e,n,c)},onChange:function(t){var e,n=this.__eventMap,i=t.name,o=t.before,a=o?"before":"after",r=t.once,s=t.scope,c=t.fn,f=n[i],d=this.get(i);f||(f={},n[i]=f),e=f[a],e||(e=[],f[a]=e),void 0!==d&&(c.call(s,{name:i,data:d}),r)||e.push({scope:s,fn:c,once:r})},reset:function(){this.__eventMap={}},switchChange:function(t){var e=(t.name,t.off),n=(this.__eventMap,(events?events.before:[])||[]);this._turnOffEventArray(n,e),n=(events?events.after:[])||[],this._turnOffEventArray(n,e)},_fireChangeEvent:function(t,e,n,i){var o,a=this.__model,r=this.__eventMap,s=r[t],c=e,f=(s?s.before:[])||[],d={name:t,origin:i,data:c},u=n?n.skipSameValue:!0,l=n?n.noBefore:!1;u&&c==i||(1!=l&&(o=this._executeEventArray(f,d,!0),void 0!==o&&(c=o,d.data=c)),a[t]=c,f=(s?s.after:[])||[],this._executeEventArray(f,d))},_turnOffEventArray:function(t,e){$.each(t,function(t,n){n.off=e})},_executeEventArray:function(t,e,n){var i,o=e;return $.each(t,function(a,r){if(r){var s=r.scope,c=r.fn,f=r.once,d=r.off;d||(i=c.call(s,o),n&&(o={name:e.name,origin:e.origin,data:i}),f&&delete t[a])}}),i}}})}();var Bind=nb.define({name:"nb.Bind",method:{init:function(t,e){var n,i=t,o=t.lastIndexOf(".");o>0&&(i=t.substring(o+1),n=t.substring(0,o)),this._name=i,this._model=n,this._opts=e},getName:function(){return this._name},getModel:function(){return this._model},getOpts:function(){return this._opts}}});nb.bind=function(t,e){var n=new Bind(t,e);return n},function(){var t=function(t,e,n){void 0!=e&&(t.$modelMappingList=t.$modelMappingList=t.$modelMappingList||[],t.$modelMappingList.push({model:e,target:n}))},e={string:function(t){var e=t.$,n=(e.prop("tagName").toLowerCase(),t.content);switch(t.type){case"text":e.text(n);break;case"html":e.html(n)}},object:function(t){var e=t.content,n=t.root,i=r(e,n),o=e.$name,a=i.$();e.$model,e.$bind;if(t.$.append(a),o){var s="$"+o,c=n[s];if(c){if("array"!=$.type(c)){var f=[c];c=n[s]=f}c.push(i)}else n[s]=i}},array:function(t){$.each(t.content,function(e,i){n({$:t.$,container:t.container,root:t.root,content:i})})},undefined:function(){}},n=function(t){var n=t.content,i=$.type(n);e[i](t)},i=function(t,e){t.$bindMappingList=t.$bindMappingList=t.$bindMappingList||[],t.$bindMappingList.push(e)},o={"class":function(t,e,n,o){var a=n["class"],r=o||t;"string"==typeof a?e.addClass(a):$.isArray(a)?$.each(a,function(t,n){"string"==typeof n?e.addClass(n):n instanceof nb.Bind&&i(r,{name:n.getName(),model:n.getModel(),target:e,attrType:"class"})}):a instanceof nb.Bind&&i(r,{name:a.getName(),model:a.getModel(),target:e,attrType:"class"})},style:function(t,e,n,o){var a=n.style,r=o||t;"string"==typeof a||$.each(a,function(t,n){n instanceof nb.Bind?i(r,{name:n.getName(),model:n.getModel(),target:e,attrName:t,attrType:"style"}):e.css(t,n)})},$text:function(t,e,o,a){var r=o.$text,s=a||t;r instanceof nb.Bind?i(s,{name:r.getName(),model:r.getModel(),target:e,attrType:"text"}):n({$:e,container:t,root:s,content:o.$text,type:"text"})},$html:function(t,e,o,a){var r=o.$html,s=a||t;r instanceof nb.Bind?i(s,{name:r.getName(),model:r.getModel(),target:e,attrType:"html"}):n({$:e,container:t,root:a||t,content:o.$html,type:"html"})}},a=function(t,e){var n;if(void 0!=t){if(n=this["$"+t],!n)throw new Error("Child not found.Please check the $name property.["+t+"]")}else n=this;return e||(n=n.$root||n.__viewInstance.$root),n},r=function(t,e){var n;return n=t.$type?c(t,e):t.$template?s(t,e):f(t,e)},s=function(t,e){},c=function(e,n){var o=e.$type,a=e.$opts,r=e.$model,s=e["class"],c=e.style;o=nb.getType(o);var f=new o,d=f.$();return a&&f.setOpts(a),s&&("string"==typeof s?d.addClass(s):$.isArray(s)&&$.each(s,function(t,e){"string"==typeof e?d.addClass(e):e instanceof nb.Bind&&i(n||f,{name:e.getName(),model:e.getModel(),target:f.$(),attrType:"class"})})),c&&d.css(c),t(n,r,f),f},f=function(t,e){var n={$:a};if($.isArray(t)){var i=$("<div>");$.each(t,function(t,e){var o=e.$name,a=r(e,n);o&&(n["$"+o]=a),i.append(a.$())}),n.$root=i.children()}else n.$root=d(n,t,e);return n},d=function(t,e,n){var a=e.tag||"div",r=n||t,s=$("<"+a+">");return $.each(e,function(a,c){var f=a.toLowerCase(),d=c instanceof nb.Bind;if("tag"==f)return!0;var u=o[a];u?u(t,s,e,n):0===f.indexOf("$")?d||s.attr("data-nb-"+f.substring(1),c):d?i(r,{name:c.getName(),model:c.getModel(),target:s,attrName:f,attrType:"attr",opts:c.getOpts()}):s.attr(f,c)}),s},u=function(){var t,e=this.opts,n=l(this.view,this.slot);n&&(t=this.__viewInstance=r(n)),this.model&&this.initDefaultModel(),e&&this.setOpts(e)},l=function(t,e){var n=t,i=$.isArray(t)?[]:{};return e&&(n=$.extend(!0,i,t),n=h(n,e)),n},h=function(t,e){var n;return"string"==typeof t?n=t:$.isNumeric(t)?n=t:t instanceof nb.Bind?n=t:(n=$.isArray(t)?[]:{},$.each(t,function(t,i){var o;"$slot"==t?(o=e[i],n["$"+o[0]]=o[1]):n[t]=h(i,e)})),n},p=function(t,e){return this.__viewInstance.$(t,e)};nb.addDefineInterceptor({scope:this,fn:function(t,e){return t&&t.view?e&&e.prototype.view?nb.define({parent:e,method:{$:p}},!0):nb.define({parent:e,method:{init:u,$:p}},!0):e}})}();