nb.define({name:"nb.mobile.model.PaginationList",parent:"nb.Model",method:{init:function(){this.set("refreshTipChangeOffset",50),this.set("moreTipChangeOffset",50),this.set("showBGOffset",50),this.set("pullDownIconClass","glyphicon glyphicon-chevron-down"),this.set("pullUpIconClass","glyphicon glyphicon-chevron-up"),this.set("refreshLoadingIconClass","glyphicon glyphicon-refresh"),this.set("moreLoadingIconClass","glyphicon glyphicon-refresh")},setList:function(t,e){this.set("list",t),this.set("hasMore",e),this.set("all",t)},appendList:function(t,e){var n=this.get("all")||[];this.set("moreList",t),this.set("hasMore",e),this.set("all",n.concat(t))},refresh:function(){},getMore:function(){},getAll:function(){}}}),nb.define({name:"nb.mobile.model.Header",parent:"nb.Model",method:{init:function(){var t="header-visible-t",e="visible-t";this.set("status",t),this.set("returnStatus",e),this.set("title","Title"),this.initOptionModel(),this.onChange({name:"visible",scope:this,fn:function(e){var n=e.data,i=t;n===!1&&(i="header-visible-f"),this.set("status",i)}}),this.onChange({name:"returnVisible",scope:this,fn:function(t){var n=t.data,i=e;n===!1&&(i="visible-f"),this.set("returnStatus",i)}}),this.onChange({name:"return",scope:this,fn:function(t){var e=this.get("returnFn"),n=this.get("scope"),i=!1;e&&(i=e.call(n))}})},initOptionModel:function(){var t=new nb.Model;this.set("options",t)}}}),nb.define({name:"nb.mobile.model.DotLoading",parent:"nb.Model",method:{init:function(){this._dotList=[".","..","..."],this.set("text","Loading"),this.onChange({name:"loading",scope:this,fn:function(t){t.data?this._start():this._stop()}})},_start:function(){this._dotIndex=0,this._changeDot()},_stop:function(){clearTimeout(this._timeout)},_changeDot:function(){var t=this,e=this._dotList[this._dotIndex++];this.set("dot",e),this._timeout=setTimeout(function(){3===t._dotIndex&&(t._dotIndex=0),t._changeDot()},500)}}}),nb.define({name:"nb.mobile.model.Page",parent:"nb.Model",method:{init:function(){var t=this.initHeader(),e=this.initContent();this.initLoading(),this.set("dataReady",!1),this.onReady(t,e),this.onChange({name:"contentData",before:!0,scope:this,fn:function(t){var n=t.data;return this.onDataReady(e,n),null}}),this.onChange({name:"requireRequestPageData",scope:this,fn:function(t){var e=t.data;e&&this.requestPageData()}})},initHeader:function(){var t=new nb.mobile.model.Header;return this.set("header",t),t},initContent:function(){var t=new nb.Model;return this.set("content",t),t},initLoading:function(){var t=new nb.mobile.model.DotLoading;this.set("loading",t),this.onChange({name:"dataReady",scope:this,fn:function(e){var n=e.data;t.set("loading",!n)}})},createQueryData:function(){},onReady:function(t,e){},onDataReady:function(t,e){},onEnter:function(){},onLeave:function(){},requestPageData:function(){var t,e,n=this,i=this.get("key"),s=this.get("ioPath"),a=nb.get(s||"app.io"),o=["get",i[0].toUpperCase(),i.substring(1),"PageData"].join(""),l=a?a[o]:null;this.set("dataReady",!1),e=n.createQueryData(),l?(t=n.get("content"),l.call(this,{data:e,success:function(t){n.set("contentData",t),n.set("dataReady",!0)},always:function(t){}})):(n.set("contentData",{}),n.set("dataReady",!0))}}}),function(){nb.define({name:"nb.mobile.model.Pages",parent:"nb.Model",method:{init:function(){this._$initEvent()},getPageModel:function(t){var e,n=t.lastIndexOf(".");return e=n>0?[t.substring(0,n),".model",t.substring(n)].join(""):[t,"Model"].join("")},_$initEvent:function(){this.onChange({name:"pages",scope:this,fn:function(t){var e=this,n=t.data,i=[],s=[],a={},o=[];$.each(n,function(t,n){var o=e.getPageModel(n),l=nb.get(o)||nb.getType("nb.mobile.model.Page"),h=new l,r=h.get("header");r.onChange({name:"return",scope:e,fn:function(t){e.hidePage(t.data)}}),h.set("key",t),a[t]=h,h.set("key",t),i.push(h),s.push(n)}),this.set("itemType",s),this.set("items",i),this.set("pageModelMap",a),this.set("pageHistory",o)}})},showPage:function(t,e){var n=this.get("pageModelMap"),i=this.get("pageHistory"),s=n[t],a=i[i.length-1],o="slideOutLeft",l="slideInRight";a?$.each(i,function(t,e){}):l="fadeIn",a&&(a.set("activeStatus",""),a.set("status",o)),s.set("status",l),s.set("activeStatus","active"),s.onEnter(),s.set("requireRequestPageData",!0,{skipSameValue:!1}),i.push(s),this._lastPageModel=a,this._animationTimeout()},hidePage:function(t){var e,n=t||{},i=n.page,s=this.get("pageHistory"),a=s.pop();for(a.set("status","slideOutRight"),a.set("activeStatus",""),a.onLeave();s.length>0&&(e=s[s.length-1],i)&&e.get("key")!==i;)s.pop();e.set("status","slideInLeft"),e.set("activeStatus","active"),e.onEnter(),this._lastPageModel=a,this._animationTimeout()},showLoading:function(){this.set("loading","loading")},hideLoading:function(){this.set("loading","")},_animationTimeout:function(){var t=this,e=this._lastPageModel;this.set("animating","animating"),setTimeout(function(){e&&e.set("status",""),t.set("animating","")},800)}}})}(),function(){nb.define({name:"nb.mobile.view.HorizontalTabListItem",view:{tag:"li","class":"nb-v-item",style:{"float":"left",width:110,"text-align":"center"},$text:nb.bind("name")}});var t=nb.define({parent:"nb.view.List",view:{tag:"ul",style:{"list-style":"none",padding:0},"class":"nb-m-h-tab-list"},method:{init:function(){var t=this,e=this.$();e.on("click",".nb-v-item",function(n){var i=$(this),s=i.attr("data-list-index");t.getModel().set("activeIndex",s),e.addClass("nb-v-active")})},onItemReady:function(t){},onItemsReady:function(t){var e=t.length,n=this.getModel().get("itemWidth"),i=n*e,s=this.$();s.css("width",i)}}});nb.define({name:"nb.mobile.view.HorizontalTabList",view:{"class":"nb-m-h-tab-list-scroll",$html:{$name:"list",$type:t}},method:{onModelReady:function(t){var e=110,n="nb.mobile.view.HorizontalTabListItem",i=t.get("itemWidth"),s=t.get("itemType");void 0===i&&t.set("itemWidth",e),void 0===s&&t.set("itemType",n),this.$("list",!0).setModel(t),t.onChange({name:"activeIndex",scope:this,fn:function(){var t=this.$(),n=this.$("list"),i=n.find(".nb-v-active");setTimeout(function(){var n=i.position(),s=n.left,a=t.scrollLeft(),o=t.width();0>s?t.animate({scrollLeft:a+n.left},300):o>s+e||t.animate({scrollLeft:a+s+e-o},300)},50)}})}}})}(),function(){var t="下拉刷新...",e="放开刷新...",n="正在刷新...",i="上拉获取更多...",s="放开获取更多...",a="正在获取更多...",o="data-list-state",l="init",h="pullDownToRefresh",r="releaseToRefresh",c="refreshData",d="pullUpToMore",f="releaseToMore",g="getMore",m=nb.define({view:{tag:"li","class":"list-group-item"},method:{setOpts:function(t){var e=t||{},n=e.label;this.$().text(n)}}});nb.define({name:"nb.mobile.view.PaginationList",view:{"class":"nb-m-p-list",$html:[{$name:"bg","class":"nb-m-p-list-bg"},{$name:"refreshBar","class":"nb-m-p-list-refresh",$html:[{$name:"refreshIcon",tag:"i","class":"icon-refresh glyphicon glyphicon-chevron-down"},{$name:"refreshTip","class":"tip",tag:"span"}]},{$name:"scroll","class":"nb-m-scroll",$html:{$name:"list",tag:"ul","class":"list-group nb-m-p-list-list"}},{$name:"moreBar","class":"nb-m-p-list-more",$html:[{$name:"moreIcon",tag:"i","class":"icon-more glyphicon glyphicon-chevron-up"},{$name:"moreTip","class":"tip",tag:"span"}]}]},method:{init:function(){},onModelReady:function(t){this.parent(t),this._refreshBarHeight=0,this._lock=!1,this._reset(),this._initEvent(),t.onChange({name:"bg",scope:this,fn:function(t){var e=t.data;if(e){e=nb.getType(e);var n=this.$("bg");n.empty(),n.append((new e).$())}}}),t.onChange({name:"list",scope:this,fn:function(t){var e=t.data;this._setList(e)}}),t.onChange({name:"hasMore",scope:this,fn:function(t){this._hasMore=t.data}}),t.onChange({name:"moreList",scope:this,fn:function(t){var e=t.data;this._appendList(e)}})},initHandler:function(){var e=this._model;if(!e)throw new Error("The model of PaginationList is null.");this._setStateWithRefreshTip(l,t,e.get("pullDownIconClass")),this._setStateWithMoreTip(l,a,e.get("pullUpIconClass")),this._moveBackScroll()},pullDownToRefreshHandler:function(){this._setStateWithRefreshTip(h,t)},releaseToRefreshHandler:function(){this._setStateWithRefreshTip(r,e)},refreshDataHandler:function(){var t=this._model;this._setStateWithRefreshTip(c,n,t.get("refreshLoadingIconClass")),this._moveBackScroll(this._refreshBarHeight),this._refresh()},releaseToMoreHandler:function(){this._setStateWithMoreTip(f,s)},pullUpToMoreHandler:function(){this._setStateWithMoreTip(d,i)},getMoreHandler:function(){var t=this._model;this._setStateWithMoreTip(g,a,t.get("moreLoadingIconClass")),this._moveBackScroll(-this._moreBarHeight),this._getMore()},_initEvent:function(){var t=this,e=this.$(),n=this.$("scroll"),i=this.$("list"),s=this.$("refreshBar"),a=this.$("moreBar"),o=this.$("bg");e.on("touchstart",function(e){var s=e.originalEvent.touches[0];t._scrollTop=n.scrollTop(),t._scrollHeight=n.height(),t._listHeight=i.height(),t._lastX=s.clientX,t._lastY=s.clientY}),e.on("touchmove",function(i){var l=i.originalEvent.touches[0],h=(l.clientX,l.clientY),r=h-t._lastY-t._scrollTop,d=t._refreshBarHeight=t._refreshBarHeight||s.height(),f=t._moreBarHeight=t._moreBarHeight||a.height(),m=t._model,p=e.offset();return h<p.top||h>p.top+e.parent().height()?(t._onTouchEnd(),void i.preventDefault()):void(!t._lock&&t._state!==c&&t._state!==g&&m&&m.refresh&&(r>0?(n.css({transform:"translate3d(0,"+r+"px,0)"}),s.css({transform:"translate3d(0,"+(r-d)+"px,0)"}),r>m.get("showBGOffset")?o.addClass("show"):o.removeClass("show"),i.preventDefault()):t._hasMore&&t._scrollHeight+t._scrollTop==t._listHeight?(r+=t._scrollTop,n.css({transform:"translate3d(0,"+r+"px,0)"}),a.css({transform:"translate3d(0,"+(r+f)+"px,0)"}),i.preventDefault()):r=0,t._setScrollTopOffset(r)))}),e.on("touchend",function(e){t._onTouchEnd()}),n.on("transitionend",function(e){a.css("transition",""),s.css("transition",""),n.css("transition",""),t._state===c||t._state===g||t._reset(),t._lock=!1,e.preventDefault()})},_onTouchEnd:function(){var t=this.$("bg");this._state===r?this.callHandler(c):this._state===f?this.callHandler(g):this._moveBackScroll(),t.removeClass("show")},_moveBackScroll:function(t){var e=this.$("scroll"),n=this.$("refreshBar"),i=this.$("moreBar"),s=t||0,a=this._scrollTopOffset||0,o=this._state;0!=a&&(this._lock=!0,o===c||o===h||o===r?(n.css({transition:"transform .5s ease-in-out"}),n.css({transform:"translate3d(0,"+(o===c?0:-this._refreshBarHeight)+"px,0)"})):o!==g&&o!==d&&o!==f||(i.css({transition:"transform .5s ease-in-out"}),i.css({transform:"translate3d(0,"+(o===g?0:this._moreBarHeight)+"px,0)"})),e.css({transition:"transform .5s ease-in-out"}),e.css({transform:"translate3d(0,"+s+"px,0)"}),this._scrollTopOffset=s)},_reset:function(){this._scrollTop=0,this._setScrollTopOffset(0)},_setScrollTopOffset:function(t){var e=(this.$(),this._model);t>=0?0===t?this.callHandler(l):t>e.get("refreshTipChangeOffset")?this.callHandler(r):this.callHandler(h):t<-e.get("moreTipChangeOffset")?this.callHandler(f):this.callHandler(d),this._scrollTopOffset=t},_setStateWithRefreshTip:function(t,e,n){var i=this.$(),s=this.$("refreshTip"),a=this.$("refreshIcon");i.attr(o,t),n&&(a.removeClass(),a.addClass("icon-refresh"),a.addClass(n)),s.text(e),this._state=t},_setStateWithMoreTip:function(t,e,n){var i=this.$(),s=this.$("moreTip"),a=this.$("moreIcon");i.attr(o,t),n&&(a.removeClass(),a.addClass("icon-more"),a.addClass(n)),s.text(e),this._state=t},_refresh:function(){this._model.refresh()},_getMore:function(){this._model.getMore()},_setList:function(t){this._addList(t,!0)},_appendList:function(t){this._addList(t)},_addList:function(t,e){var n=this.$("list"),i=this._model.get("itemType"),s=m;i&&(s=nb.getType(i)),e&&n.empty(),t&&$.each(t,function(t,e){var i=new s;i.setOpts(e),n.append(i.$())}),this._setScrollTopOffset(0),this._resetTip()},_resetTip:function(){this.$("refreshTip").text(t),this.$("moreTip").text(i)}}})}(),nb.define({name:"nb.mobile.view.Header",view:{"class":"nb-m-page-header row",$html:[{"class":"col-xs-3 return",$html:{$name:"actionReturn","class":["inner",nb.bind("returnStatus")],$html:{tag:"span","class":"glyphicon glyphicon-chevron-left"}}},{"class":"col-xs-6 title",$text:nb.bind("title")},{$name:"optsWrapper","class":"col-xs-3 opts"}]},method:{init:function(){var t=this;this.$("actionReturn").on("click",function(e){var n=t.getModel();n.set("return",null,{skipSameValue:!1})})},onModelReady:function(t){t.onChange({name:"optionsType",scope:this,fn:function(e){var n,i,s=e.data;s&&(i=nb.getType(s),n=new i,n.setOpts(t.get("options")),this.$("optsWrapper").empty().append(n.$()))}})}}}),nb.define({name:"nb.mobile.view.DotLoading",view:{tag:"p","class":"nb-m-loading-dot",$html:[{tag:"span",$text:nb.bind("text")},{tag:"span",$text:nb.bind("dot")}]}}),nb.define({name:"nb.mobile.view.Page",view:{"class":["nb-m-page","container-fluid",nb.bind("key"),nb.bind("activeStatus"),nb.bind("status"),nb.bind("header.status")],"data-ready":nb.bind("dataReady"),$html:[{$type:"nb.mobile.view.Header",$model:"header"},{"class":"nb-m-page-content-wrapper",$html:[{"class":"nb-m-page-content",$slot:"content"},{"class":"nb-m-page-content-mask",$html:{$type:"nb.mobile.view.DotLoading",$model:"loading"}}]}]}}),nb.define({name:"nb.mobile.view.Pages",parent:"nb.view.List",view:{"class":"nb-m-pages abs-full"}}),function(){nb.define({name:"nb.mobile.view.PageAnimationMask",view:{"class":["nb-m-page-ani-mask abs-full",nb.bind("animating")]}})}(),function(){nb.define({name:"nb.mobile.view.PageLoadingMask",view:{"class":["nb-m-page-loading-mask abs-full",nb.bind("loading")]}})}(),nb.define({name:"nb.mobile.Model",parent:"nb.Model",method:{init:function(){this._$initModel(),this._$initData(),this._$initEvent()},_$initModel:function(){this.set("pagesModel",new nb.mobile.model.Pages)},_$initEvent:function(){var t=this,e=this.get("pagesModel");this.onChange({name:"pages",scope:this,fn:function(t){var e=t.data,n=this.get("pagesModel");n.set("pages",e)}}),e.onChange({name:"pageModelMap",scope:this,fn:function(e){var n=e.origin,i=e.data;n&&$.each(n,function(t,e){}),i&&$.each(i,function(e,n){n.set("appModel",t),t.onPageModelReady(e,n)})}})},_$initData:function(){this._pageModelReadyListenerMap={}},addPage:function(){},showPage:function(t,e){var n=this.get("pagesModel");n.showPage(t,e)},hidePage:function(t){var e=this.get("pagesModel");e.hidePage(t)},showLoading:function(){var t=this.get("pagesModel");t.showLoading()},hideLoading:function(){var t=this.get("pagesModel");t.hideLoading()},appPageModelReadyListener:function(t,e){var n=this._pageModelReadyListenerMap;n[t]=e},onPageModelReady:function(t,e){var n=this._pageModelReadyListenerMap,i=n[t];i&&i.call(this,e,e.get("content"))}}}),nb.define({name:"nb.mobile.Application",model:"nb.mobile.Model",view:{"class":"nb-m-app",$html:[{$name:"pageContainer","class":"nb-m-page-container abs-full",$html:[{$name:"pages",$type:"nb.mobile.view.Pages",$model:"pagesModel"},{$name:"pageAnimationMask",$type:"nb.mobile.view.PageAnimationMask",$model:"pagesModel"},{$name:"pageLoadingMask",$type:"nb.mobile.view.PageLoadingMask",$model:"pagesModel"}]},{$name:"dialogConfirm",$type:"nb.bs.dialog.Confirm",$model:"confirmModel"},{$slot:"extend"}]},method:{onModelReady:function(t){t.onChange({name:"confirmModel",scope:this,fn:function(t){this.$("dialogConfirm",!0).show()}})},onStart:function(){var t=this.getModel();nb.name("app.model",t)}}}),function(){var t,e,n,i={},s={},a="main",o=!1,l=!1,h=nb.define({name:"nb.mobile.Shell",method:{init:function(){},start:function(){t=nb.get("app.Application")||nb.getType("nb.mobile.Application"),e=new t,n=e.getModel(),$.each(s,function(t,e){n.appPageModelReadyListener(t,e)}),n.set("pages",i),$(document).ready(function(){e.$().appendTo(document.body),a&&(n.showPage(a),o=!0)}),e.onStart(),l=!0},addPage:function(t,e){i[t]=e},addPageModelReadyListener:function(t,e){s[t]=e},setDefaultPage:function(t){a=t,l&&t&&!o&&n.showPage(a)},showPage:function(t,e){n.showPage(t,e)}}}),r=new h;nb.name("nb.mobile.shell",r)}();